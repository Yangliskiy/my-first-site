import asyncio
import logging
import os
import random
import re
import sqlite3  # –î–æ–±–∞–≤–∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command
from aiogram.types import InlineKeyboardButton, FSInputFile, CallbackQuery, InputMediaPhoto, Message 
from aiogram.utils.keyboard import InlineKeyboardBuilder
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.storage.memory import MemoryStorage

# –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–π —Ç–æ–∫–µ–Ω
API_TOKEN = '8387326395:AAG4U8idd-qfG7f_pR3n2Uy-MbIKT8tyf7g'
ADMIN_ID = 885753609
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
bot = Bot(token=API_TOKEN)
dp = Dispatcher(storage=MemoryStorage())

# --- –ë–ê–ó–ê –î–ê–ù–ù–´–• (SQLite) ---
# –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
conn = sqlite3.connect('users.db')
cursor = conn.cursor()
cursor.execute('CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY)')
conn.commit()

def add_user_to_db(user_id):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑—É, –µ—Å–ª–∏ –µ–≥–æ —Ç–∞–º –Ω–µ—Ç"""
    cursor.execute('INSERT OR IGNORE INTO users (id) VALUES (?)', (user_id,))
    conn.commit()

def get_all_users():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    cursor.execute('SELECT id FROM users')
    return cursor.fetchall()

# --- –ú–ê–®–ò–ù–ê –°–û–°–¢–û–Ø–ù–ò–ô ---
class OrderState(StatesGroup):
    choosing_city = State()
    choosing_product = State()
    choosing_district = State()
    choosing_payment = State()

# --- –°–ü–ò–°–ö–ò –î–ê–ù–ù–´–• ---
cities = [
    "–•–∞—Ä—å–∫–æ–≤", "–û–¥–µ—Å—Å–∞", "–ö–∏–µ–≤", "–î–Ω–µ–ø—Ä", "–ù–∏–∫–æ–ª–∞–µ–≤", 
    "–ö—Ä–∏–≤–æ–π –†–æ–≥", "–õ—å–≤–æ–≤", "–ö–æ—Å—Ç–æ–ø–æ–ª—å", "–ß–µ—Ä–∫–∞—Å—Å—ã",
    "–°–º–µ–ª–∞", "–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫", "–ù–æ–≤–∞—è –û–¥–µ—Å—Å–∞", "–°–ª–æ–±–æ–∂–∞–Ω—Å–∫–æ–µ", "–ó–Ω–∞–º–µ–Ω–æ–≤–∫–∞", "–ë–æ—Ä–∏—Å–ø–æ–ª—å", 
    "–í—ã—à–≥–æ—Ä–æ–¥", "–ß–µ—Ä–Ω–æ–≤—Ü—ã", "–í–∞—Å–∏—â–µ–≤–æ", "–õ—é–±–æ—Ç–∏–Ω", "–ù–µ—Ç–∏—à–∏–Ω", 
    "–ë–µ–∑–ª—é–¥–æ–≤–∫–∞", "–ë—Ä–æ–≤–∞—Ä—ã", "–õ–æ–∑–æ–≤–∞—è", "–ü–æ–ª—Ç–∞–≤–∞", "–ñ–∏—Ç–æ–º–∏—Ä", 
    "–ú–µ—Ä–µ—Ñ–∞", "–ë—É–¥—ã", "–ó–º–∏–µ–≤", "–ë–æ—è—Ä–∫–∞", "–ù–µ–∂–∏–Ω", "–ò—Ä–ø–µ–Ω—å", 
    "–û—Å—Ç—Ä–æ–≥", "–†–æ–≤–Ω–æ", "–£–º–∞–Ω—å", "–°—É–º—ã", "–í–∏–Ω–Ω–∏—Ü–∞", "–ë—Ä–∞—Ü–ª–∞–≤", 
    "–ö–∞–∑–∞—Ç–∏–Ω", "–ù–µ–º–∏—Ä–æ–≤", "–ñ–º–µ—Ä–∏–Ω–∫–∞", "–ü–∞–≤–ª–æ–≥—Ä–∞–¥", "–ü–æ–¥–≥–æ—Ä–æ–¥–Ω–æ–µ", 
    "–ë–µ–ª–∞—è –¶–µ—Ä–∫–æ–≤—å", "–°—Ç—Ä—ã–π", "–î—Ä–æ–≥–æ–±—ã—á", "–ë–µ—Ä–¥–∏—á–µ–≤", "–¢—Ä—É—Å–∫–∞–≤–µ—Ü", 
    "–í–æ–∑–Ω–µ—Å–µ–Ω—Å–∫", "–ö–æ–Ω–æ—Ç–æ–ø", "–®–æ—Å—Ç–∫–∞", "–ó–∞–≤–∞–ª—å–µ", "–ñ–∞–∫—á–∏–∫", "–ë–µ—Ä–µ–∑–æ–≤–∫–∞", 
    "–°–∞–≤—Ä–∞–Ω—å", "–ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫", "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü–∫–∏–π", "–ò–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫–æ–≤—Å–∫", "–ü–µ—Ä–≤–æ–º–∞–π—Å–∫", 
    "–°–ª–∞–≤—è–Ω—Å–∫", "–ê—Ö—Ç—ã—Ä–∫–∞", "–†–æ–º–Ω—ã", "–ß—É–≥—É–µ–≤", "–§–∞—Å—Ç–æ–≤", "–¢–µ—Ä–Ω–æ–ø–æ–ª—å", "–ö–∞–ª—É—à", 
    "–ö—Ä–∞–º–∞—Ç–æ—Ä—Å–∫", "–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞", "–ö–∞–º—è–Ω–µ—Ü-–ü–æ–¥–æ–ª—å—Å–∫–∏–π", "–ß–µ—Ä–Ω–∏–≥–æ–≤", "–õ—É—Ü–∫", 
    "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—è", "–í–∞—Å–∏–ª—å–∫–æ–≤", "–•–æ—Ä–æ–ª", "–•–µ—Ä—Å–æ–Ω", "–û–±—É—Ö–æ–≤", "–ó–∞–ø–æ—Ä–æ–∂—å–µ", 
    "–ë–∞–ª–∞–∫–ª–µ—è", "–ë–∞—à—Ç–∞–Ω–∫–∞", "–ù–æ–≤—ã–π –ë—É–≥", "–ö–æ—Ä–æ—Å—Ç—ã—à–µ–≤", "–ó–≤—è–≥–µ–ª—å", "–ö–æ–±–ª–µ–≤–æ"
]

products = [
    "–ê–ú–§ - 5 –≥ 1350–≥—Ä–Ω.",
    "–ê–ú–§ - 10 –≥ 2300–≥—Ä–Ω.",
    "A-PVP - 2 –≥ 900–≥—Ä–Ω.",
    "–ê–ú–§ - 0.5 –≥ 310–≥—Ä–Ω.",
    "A-PVP - 5 –≥ 1800–≥—Ä–Ω.",
    "–ê–ú–§ - 1 –≥ 450–≥—Ä–Ω.",
    "–ú–ï–§–ï–î–†–û–ù HQ - 0.5 –≥ 390–≥—Ä–Ω.",
    "–®–∏—à–∫–∏ –ò–Ω–¥–æ—Ä HQ - 1–≥ 380–≥—Ä–Ω.",
    "A-PVP HQ - 0.25 –≥ 280–≥—Ä–Ω.",
    "A-PVP HQ - 1 –≥ 555–≥—Ä–Ω.",
    "A-PVP –í—Å–µ —Ü–≤–µ—Ç–∞ - 3 –≥ 1250–≥—Ä–Ω.",
    "A-PVP HQ - 0.5 –≥ 350–≥—Ä–Ω.",
    "–ê–ú–§ - 2 –≥ 780–≥—Ä–Ω.",
    "–ê–ú–§ - 5 –≥ 1000–≥—Ä–Ω.",
    "–†–ê–°–ü–†–û–î–ê–ñ–ê!!! –≠–∫—Å—Ç–∞–∑–∏ MDMA - 1 —à—Ç 300–≥—Ä–Ω."
]

# --- –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –†–ê–ô–û–ù–û–í ---
# –ó–¥–µ—Å—å –ø—Ä–æ–ø–∏—Å–∞–Ω—ã —Ä–∞–π–æ–Ω—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
city_districts = {
    "–•–∞—Ä—å–∫–æ–≤": [
        "–°–∞–ª—Ç–æ–≤–∫–∞", "–•–¢–ó", "–¶–µ–Ω—Ç—Ä", "–ê–ª–µ–∫—Å–µ–µ–≤–∫–∞", "–•–æ–ª–æ–¥–Ω–∞—è –ì–æ—Ä–∞",
        "–ù–æ–≤—ã–µ –î–æ–º–∞", "–ë–∞–≤–∞—Ä–∏—è", "–ì–∞–≥–∞—Ä–∏–Ω–∞", "–û–¥–µ—Å—Å–∫–∞—è", "–ñ—É–∫–æ–≤—Å–∫–æ–≥–æ"
    ],
    "–û–¥–µ—Å—Å–∞": [
        "–ê—Ä–∫–∞–¥–∏—è", "–¢–∞–∏—Ä–æ–≤–∞", "–ü–æ—Å–µ–ª–æ–∫ –ö–æ—Ç–æ–≤—Å–∫–æ–≥–æ", "–ß–µ—Ä–µ–º—É—à–∫–∏",
        "–¶–µ–Ω—Ç—Ä", "–ú–æ–ª–¥–∞–≤–∞–Ω–∫–∞", "–§–æ–Ω—Ç–∞–Ω", "–°–ª–æ–±–æ–¥–∫–∞", "–õ—É–∑–∞–Ω–æ–≤–∫–∞"
    ],
    "–ö–∏–µ–≤": [
        "–ì–æ–ª–æ—Å–µ–µ–≤—Å–∫–∏–π", "–ü–æ–∑–Ω—è–∫–∏", "–ù–∏–≤–∫–∏", "–¢—Ä–æ–µ—â–∏–Ω–∞", "–í–æ–∫–∑–∞–ª", 
        "–û–±–æ–ª–æ–Ω—å", "–ü–µ—á–µ—Ä—Å–∫", "–ü–æ–¥–æ–ª", "–î–∞—Ä–Ω–∏—Ü–∞", "–°–æ–ª–æ–º–µ–Ω–∫–∞", "–ë–æ—Ä—â–∞–≥–æ–≤–∫–∞"
    ],
    "–î–Ω–µ–ø—Ä": [
        "–¶–µ–Ω—Ç—Ä", "–ü–æ–±–µ–¥–∞", "–¢–æ–ø–æ–ª—å", "–ì–∞–≥–∞—Ä–∏–Ω–∞", "–ö–∏—Ä–æ–≤–∞ (–ü–æ–ª—è)",
        "–õ–µ–≤—ã–π –±–µ—Ä–µ–≥", "–ü–∞—Ä—É—Å", "–ö—Ä–∞—Å–Ω—ã–π –ö–∞–º–µ–Ω—å", "12 –∫–≤–∞—Ä—Ç–∞–ª", "–ü—Ä–∏–¥–Ω–µ–ø—Ä–æ–≤—Å–∫"
    ],
    "–ù–∏–∫–æ–ª–∞–µ–≤": [
        "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π", "–ù–∞–º—ã–≤", "–õ–µ—Å–∫–∏", "–ö–æ—Ä–∞–±–µ–ª—å–Ω—ã–π", 
        "–ò–Ω–≥—É–ª—å—Å–∫–∏–π", "–°–æ–ª—è–Ω—ã–µ", "–û–∫—Ç—è–±—Ä—å—Å–∫–æ–µ"
    ],
    "–ö—Ä–∏–≤–æ–π –†–æ–≥": [
        "95 –∫–≤–∞—Ä—Ç–∞–ª", "–°–æ—Ü–≥–æ—Ä–æ–¥", "–î–∞–º–∞–Ω—Å–∫–∏–π", "–ó–∞—Ä–µ—á–Ω—ã–π", 
        "–°–∞–∫—Å–∞–≥–∞–Ω—Å–∫–∏–π", "–¢–µ—Ä–Ω—ã", "–ö–∞—Ä–∞—á—É–Ω—ã", "–í–æ—Å—Ç–æ—á–Ω—ã–π"
    ],
    "–õ—å–≤–æ–≤": [
        "–ü–ª–æ—â–∞–¥—å –†—ã–Ω–æ–∫", "–°–∏—Ö–æ–≤", "–õ–µ–≤–∞–Ω–¥–æ–≤–∫–∞", "–¶–µ–Ω—Ç—Ä",
        "–ü—Ä–∏–≤–æ–∫–∑–∞–ª—å–Ω–∞—è", "–®–µ–≤—á–µ–Ω–∫–æ–≤—Å–∫–∏–π", "–õ—ã—á–∞–∫–æ–≤—Å–∫–∏–π", "–†—è—Å–Ω–µ"
    ],
    "–ö–æ—Å—Ç–æ–ø–æ–ª—å": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–ó–∞—Ä–µ—á—å–µ", "–•–º–∏–ª—å–Ω–∏–∫–∏", "–ü–æ–±–µ–¥–∞"
    ],
    "–ß–µ—Ä–∫–∞—Å—Å—ã": [
        "–¶–µ–Ω—Ç—Ä", "–ú—ã—Ç–Ω–∏—Ü–∞", "–ö–∞–∑–±–µ—Ç", "–Æ–ó–†", "–î–Ω–µ–ø—Ä–æ–≤—Å–∫–∏–π", "–•–∏–º–ø–æ—Å–µ–ª–æ–∫"
    ],
    "–°–º–µ–ª–∞": [
        "–ù–∏–∫–æ–ª–∞–µ–≤–∫–∞", "–ú–∞–∑—É—Ä–∞", "–ú–∞—à—Å—Ç—Ä–æ–π", "–†–ü–ú", "–ó–∞–≥—Ä–µ–±–ª—è"
    ],
    "–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫": [
        "–¶–µ–Ω—Ç—Ä", "–†–µ—à–∫—É—Ç", "–ö—É–ª–µ–±–æ–≤–∫–∞", "–ü–µ—Ä–µ–≤–∞–ª", "–ñ–∏–≤–æ—Ç–∏–ª–æ–≤–∫–∞"
    ],
    "–ù–æ–≤–∞—è –û–¥–µ—Å—Å–∞": [
        "–¶–µ–Ω—Ç—Ä", "–≠–ª–µ–≤–∞—Ç–æ—Ä", "–ö–∞—à–ø–µ—Ä–æ–≤–∫–∞", "–ú–∞—Å–ª–æ–∑–∞–≤–æ–¥"
    ],
    "–°–ª–æ–±–æ–∂–∞–Ω—Å–∫–æ–µ": [
        "–¶–µ–Ω—Ç—Ä", "–ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω", "–ö–æ—Ç—Ç–µ–¥–∂–∏", "–ó–æ–ª–æ—Ç—ã–µ –∫–ª—é—á–∏"
    ],
    "–ó–Ω–∞–º–µ–Ω–æ–≤–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∑–ª–µ —à–∫–æ–ª—ã", "–°—Ç–∞–Ω—Ü–∏—è", "–õ–µ—Å—Ö–æ–∑"
    ],
    "–ë–æ—Ä–∏—Å–ø–æ–ª—å": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–†–∞–∑–≤–∏–ª–∫–∞", "–ó–≤–µ–∑–¥–Ω—ã–π", "–°–æ—Ü–≥–æ—Ä–æ–¥–æ–∫"
    ],
    "–í—ã—à–≥–æ—Ä–æ–¥": [
        "–¶–µ–Ω—Ç—Ä", "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è", "–ö–∏–µ–≤—Å–∫–∞—è", "–ö—É—Ä–≥—É–∑–æ–≤–∞"
    ],
    "–ß–µ—Ä–Ω–æ–≤—Ü—ã": [
        "–¶–µ–Ω—Ç—Ä", "–ì—Ä–∞–≤–∏—Ç–æ–Ω", "–†–æ—à–∞", "–ö–µ–º–ø–∏–Ω–≥", "–ö–∞–ª–∏—á–∞–Ω–∫–∞", "–ü—Ä–æ—Å–ø–µ–∫—Ç"
    ],
    "–í–∞—Å–∏—â–µ–≤–æ": [
        "–¶–µ–Ω—Ç—Ä", "–°—Ç–∞–Ω—Ü–∏—è", "–®–∫–æ–ª–∞", "–ü–æ—Å—Å–æ–≤–µ—Ç"
    ],
    "–õ—é–±–æ—Ç–∏–Ω": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–ì–∏–µ–≤–∫–∞", "–ö–∞—Ä–∞–≤–∞–Ω", "–í–æ–¥—è–Ω–æ–µ"
    ],
    "–ù–µ—Ç–∏—à–∏–Ω": [
        "1-–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω", "2-–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω", "–í–∞—Ä—à–∞–≤—Å–∫–∞—è", "–¶–µ–Ω—Ç—Ä"
    ],
    "–ë–µ–∑–ª—é–¥–æ–≤–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–ö–∞—Ä—å–µ—Ä", "–ù–∞–≥–æ—Ä—å–µ", "–ö–ª—É–±"
    ],
    "–ë—Ä–æ–≤–∞—Ä—ã": [
        "–¶–µ–Ω—Ç—Ä", "–¢–æ—Ä–≥–º–∞—à", "–ú–∞—Å—Å–∏–≤", "–ü—Ä–æ–º–∑–æ–Ω–∞", "–ò–Ω—Ç–µ—Ä–Ω–∞—Ç"
    ],
    "–õ–æ–∑–æ–≤–∞—è": [
        "–¶–µ–Ω—Ç—Ä", "–ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω", "–°–∞—Ö–∞–ª–∏–Ω", "–í–æ–∫–∑–∞–ª", "–ê–≤–∏–ª–æ–≤–∫–∞"
    ],
    "–ü–æ–ª—Ç–∞–≤–∞": [
        "–¶–µ–Ω—Ç—Ä", "–õ–µ–≤–∞–¥–∞", "–ê–ª–º–∞–∑–Ω—ã–π", "–°–∞–¥—ã-1", "–°–∞–¥—ã-2", "–ü–æ–¥–æ–ª", "–ë—Ä–∞–∏–ª–∫–∏"
    ],
    "–ñ–∏—Ç–æ–º–∏—Ä": [
        "–¶–µ–Ω—Ç—Ä", "–ë–æ–≥—É–Ω–∏—è", "–ö—Ä–æ—à–Ω—è", "–ü–æ–ª–µ–≤–∞—è", "–ö–æ—Ä–±—É—Ç–æ–≤–∫–∞", "–í–æ–∫–∑–∞–ª"
    ],
    "–ú–µ—Ä–µ—Ñ–∞": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–°—Ç–µ–∫–æ–ª—å–Ω—ã–π", "–ê—Ä—Ç–µ–º–æ–≤–∫–∞", "–°–µ–ª–µ–∫—Ü–∏–æ–Ω–Ω–∞—è"
    ],
    "–ë—É–¥—ã": [
        "–¶–µ–Ω—Ç—Ä", "–§–∞—Ä—Ñ–æ—Ä–æ–≤—ã–π", "–ü—Ä—É–¥", "–°—Ç–∞–Ω—Ü–∏—è"
    ],
    "–ó–º–∏–µ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω", "–ó–∞–º–æ—Å—Ç—å–µ", "–í–æ–∫–∑–∞–ª"
    ],
    "–ë–æ—è—Ä–∫–∞": [
        "–°—Ç–∞—Ä–∞—è –ë–æ—è—Ä–∫–∞", "–ù–æ–≤–∞—è –ë–æ—è—Ä–∫–∞", "–¢–∞—Ä–∞—Å–æ–≤–∫–∞", "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π"
    ],
    "–ù–µ–∂–∏–Ω": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–ì—É–Ω—å–∫–∏", "–ö—Ä—É—á–∞", "–¢—Ä–µ—Ç–∏–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω"
    ],
    "–ò—Ä–ø–µ–Ω—å": [
        "–¶–µ–Ω—Ç—Ä", "–°–∏–Ω–µ—Ä–≥–∏—è", "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è", "–í–æ–∫–∑–∞–ª", "–ë–ö–ó"
    ],
    "–û—Å—Ç—Ä–æ–≥": [
        "–¶–µ–Ω—Ç—Ä", "–ê–∫–∞–¥–µ–º–∏—è", "–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥", "–õ—É—Ü–∫–∞—è"
    ],
    "–†–æ–≤–Ω–æ": [
        "–¶–µ–Ω—Ç—Ä", "–Æ–±–∏–ª–µ–π–Ω—ã–π", "–°–µ–≤–µ—Ä–Ω—ã–π", "–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª", "–ü–∏–≤–∑–∞–≤–æ–¥", "–ë–æ—è—Ä–∫–∞"
    ],
    "–£–º–∞–Ω—å": [
        "–¶–µ–Ω—Ç—Ä", "–î–û–°—ã", "–û—Å—Ç–∞—à–æ–≤–∫–∞", "–ù–æ–≤–∞—è –£–º–∞–Ω—å", "–ë–∞–±–∫–ø", "–°–æ—Ñ–∏–µ–≤–∫–∞"
    ],
    "–°—É–º—ã": [
        "–¶–µ–Ω—Ç—Ä", "9-–∫–∞", "–•–∏–º–≥–æ—Ä–æ–¥–æ–∫", "–†–æ–º–µ–Ω—Å–∫–∞—è", "–ö—É—Ä—Å–∫–∞—è", "–ë–∞—Ä–∞–Ω–æ–≤–∫–∞"
    ],
    "–í–∏–Ω–Ω–∏—Ü–∞": [
        "–¶–µ–Ω—Ç—Ä", "–í–∏—à–µ–Ω–∫–∞", "–ó–∞–º–æ—Å—Ç—å–µ", "–°—Ç–∞—Ä—ã–π –≥–æ—Ä–æ–¥", "–°–ª–∞–≤—è–Ω–∫–∞", "–¢—è–∂–∏–ª–æ–≤"
    ],
    "–ë—Ä–∞—Ü–ª–∞–≤": [
        "–¶–µ–Ω—Ç—Ä", "–†—ã–Ω–æ–∫", "–ó–∞–º–∫–æ–≤–∞—è –≥–æ—Ä–∞", "–ê–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è"
    ],
    "–ö–∞–∑–∞—Ç–∏–Ω": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–ü–†–ë", "–£—á–∏–ª–∏—â–µ"
    ],
    "–ù–µ–º–∏—Ä–æ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–ü–∞—Ä–∫", "–ë–∞–∑–∞—Ä", "–°–ø–∏—Ä—Ç–∑–∞–≤–æ–¥"
    ],
    "–ñ–º–µ—Ä–∏–Ω–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–ü–µ—Ç—Ä–æ–≤–∫–∞", "–¢–≠–¶", "–ö–æ—Ä—á–µ–≤–∫–∞"
    ],
    "–ü–∞–≤–ª–æ–≥—Ä–∞–¥": [
        "–¶–µ–Ω—Ç—Ä", "–ü–ó–¢–û", "40 –ª–µ—Ç", "–ü–æ–ª–∏–≥–æ–Ω", "–•–∏–º–∑–∞–≤–æ–¥", "–õ–∏—Ç–º–∞—à"
    ],
    "–ü–æ–¥–≥–æ—Ä–æ–¥–Ω–æ–µ": [
        "–¶–µ–Ω—Ç—Ä", "–ï—Ä–º–æ–ª–∞–µ–≤–∫–∞", "–°–æ–ª–Ω–µ—á–Ω—ã–π", "–î–∞—á–∏"
    ],
    "–ë–µ–ª–∞—è –¶–µ—Ä–∫–æ–≤—å": [
        "–¶–µ–Ω—Ç—Ä", "–õ–µ–≤–∞–Ω–µ–≤—Å–∫–æ–≥–æ", "–ú–∞—Å—Å–∏–≤", "–í–æ–∫–∑–∞–ª—å–Ω–∞—è", "–¢–∞—Ä–∞—â–∞–Ω—Å–∫–∏–π"
    ],
    "–°—Ç—Ä—ã–π": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω", "–ù–æ–≤—ã–π –°–≤–µ—Ç"
    ],
    "–î—Ä–æ–≥–æ–±—ã—á": [
        "–¶–µ–Ω—Ç—Ä", "–°–∞–º–±–æ—Ä—Å–∫–∞—è", "–ì–æ—Ä–∫–∞", "–ú–ª–∏–Ω–∫–∏", "–í–æ–∫–∑–∞–ª"
    ],
    "–ë–µ—Ä–¥–∏—á–µ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–ö—Ä–∞—Å–Ω–∞—è –≥–æ—Ä–∞", "–í–æ–∫–∑–∞–ª", "–ú—è—Å–æ–∫–æ–º–±–∏–Ω–∞—Ç", "–ó–∞–≥—Ä–µ–±–µ–ª—å–µ"
    ],
    "–¢—Ä—É—Å–∫–∞–≤–µ—Ü": [
        "–¶–µ–Ω—Ç—Ä", "–ë—é–≤–µ—Ç", "–í–æ–∫–∑–∞–ª", "–°—Ç–µ–±–Ω–∏–∫"
    ],
    "–í–æ–∑–Ω–µ—Å–µ–Ω—Å–∫": [
        "–¶–µ–Ω—Ç—Ä", "–ë–æ–ª–≥–∞—Ä–∫–∞", "–ù–∞—Ç—è–≥–∞–π–ª–æ–≤–∫–∞", "3-–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω"
    ],
    "–ö–æ–Ω–æ—Ç–æ–ø": [
        "–¶–µ–Ω—Ç—Ä", "–í–æ—Ä–æ–Ω—Ü–æ–≤–æ", "–ü–æ—Ä—Ç", "–ñ–∏–ª–º–∞—Å—Å–∏–≤", "–ö—É–±–∞"
    ],
    "–®–æ—Å—Ç–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–ö–∞–ø—Å—É–ª—å", "–õ–æ–∫–æ—Ç–∫–∏", "32-–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω"
    ],
    "–ó–∞–≤–∞–ª—å–µ": [
        "–¶–µ–Ω—Ç—Ä", "–ó–∞–≤–æ–¥", "–Æ–∂–Ω—ã–π", "–®–∫–æ–ª–∞"
    ],
    "–ñ–∞–∫—á–∏–∫": [ # –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –æ–ø–µ—á–∞—Ç–∫–∞, –ø–æ—Å—Ç–∞–≤–∏–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ
        "–¶–µ–Ω—Ç—Ä", "–°—Ç–∞–Ω—Ü–∏—è", "–£–ª–∏—Ü–∞ –®–µ–≤—á–µ–Ω–∫–æ", "–ú–∞–≥–∞–∑–∏–Ω"
    ],
    "–ë–µ—Ä–µ–∑–æ–≤–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–ó–∞–±–∞–ª–∫–∞", "–í–æ–∫–∑–∞–ª", "–ü–∞—Ä–∫"
    ],
    "–°–∞–≤—Ä–∞–Ω—å": [
        "–¶–µ–Ω—Ç—Ä", "–†—ã–Ω–æ–∫", "–õ–µ—Å—Ö–æ–∑", "–ê–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è"
    ],
    "–ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫": [
        "–¶–µ–Ω—Ç—Ä", "–ü–ª—è–∂", "–ü–æ—Ä—Ç", "–ú–æ–Ω–æ–ª–∏—Ç", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∫–∞"
    ],
    "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü–∫–∏–π": [
        "–¶–µ–Ω—Ç—Ä", "–ö–æ–≤–∞–ª–µ–≤–∫–∞", "–ë–∞–ª–∞—à–æ–≤–∫–∞", "–ù–∏–∫–æ–ª–∞–µ–≤–∫–∞", "–ü–æ–ø–æ–≤–∞", "–í–æ–ª–∫–æ–≤–∞"
    ],
    "–ò–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫–æ–≤—Å–∫": [
        "–¶–µ–Ω—Ç—Ä", "–ü–∞—Å–µ—á–Ω–∞—è", "–ö–∞—Å–∫–∞–¥", "–ë–ê–ú", "–í–æ–∫–∑–∞–ª", "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è"
    ],
    "–ü–µ—Ä–≤–æ–º–∞–π—Å–∫": [
        "–¶–µ–Ω—Ç—Ä", "–§—Ä–µ–≥–∞—Ç", "–ö–æ—Ä–æ—Ç—á–µ–Ω–∫–æ", "–°–∞—Ö–∞—Ä–Ω—ã–π –∑–∞–≤–æ–¥", "–°–∫–∞–ª–∞"
    ],
    "–°–ª–∞–≤—è–Ω—Å–∫": [
        "–¶–µ–Ω—Ç—Ä", "–ê—Ä—Ç–µ–º–∞", "–°–ª–∞–≤–∫—É—Ä–æ—Ä—Ç", "–•–∏–º–∏–∫", "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π"
    ],
    "–ê—Ö—Ç—ã—Ä–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–î–∞—á–Ω—ã–π", "8-—è —Å–æ—Ç–Ω—è", "–ù–µ—Ñ—Ç—è–Ω–∏–∫–æ–≤"
    ],
    "–†–æ–º–Ω—ã": [
        "–¶–µ–Ω—Ç—Ä", "–ó–∞—Å—É–ª—å–µ", "–ö–∞—Ö–æ–≤–∫–∞", "–ü—Ä–æ–∫–æ–ø–µ–Ω–∫–æ"
    ],
    "–ß—É–≥—É–µ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–ê–≤–∏–∞—Ç–æ—Ä", "–ë–∞—à–∫–∏—Ä–æ–≤–∫–∞", "–í–æ–∫–∑–∞–ª"
    ],
    "–§–∞—Å—Ç–æ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–ó–∞–≤–æ–∫–∑–∞–ª—å–µ", "–ö–∞–∑–Ω–æ–≤–∫–∞", "–°–Ω–µ–≥—É—Ä–æ–≤–∫–∞"
    ],
    "–¢–µ—Ä–Ω–æ–ø–æ–ª—å": [
        "–¶–µ–Ω—Ç—Ä", "–î—Ä—É–∂–±–∞", "–ë–ê–ú", "–í–æ—Å—Ç–æ—á–Ω—ã–π", "–ê–ª—è—Å–∫–∞", "–ö–∞–Ω–∞–¥–∞"
    ],
    "–ö–∞–ª—É—à": [
        "–¶–µ–Ω—Ç—Ä", "–ü–æ—Å–µ–ª–æ–∫", "–í—ã—Å–æ—á–∞–Ω–∫–∞", "–ó–∞–≥–æ—Ä—å–µ"
    ],
    "–ö—Ä–∞–º–∞—Ç–æ—Ä—Å–∫": [
        "–¶–µ–Ω—Ç—Ä", "–°–æ—Ü–≥–æ—Ä–æ–¥", "–î–∞–º–∞–Ω—Å–∫–∏–π", "–õ–∞–∑—É—Ä–Ω—ã–π", "–°—Ç–∞–Ω–∫–æ—Å—Ç—Ä–æ–π"
    ],
    "–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–≤–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–ù—É–ª–µ–≤–æ–π", "–°–≤–∏—Ö–æ–∑", "–í–æ–∫–∑–∞–ª"
    ],
    "–ö–∞–º—è–Ω–µ—Ü-–ü–æ–¥–æ–ª—å—Å–∫–∏–π": [
        "–°—Ç–∞—Ä—ã–π –≥–æ—Ä–æ–¥", "–¶–µ–Ω—Ç—Ä", "–ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω", "–†—É—Å—Å–∫–∏–µ —Ñ–æ–ª—å–≤–∞—Ä–∫–∏", "–ü–æ—Å–µ–ª–æ–∫"
    ],
    "–ß–µ—Ä–Ω–∏–≥–æ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–†–æ–∫–æ—Å—Å–æ–≤—Å–∫–æ–≥–æ", "–ú–∞—Å–∞–Ω—ã", "–®–µ—Ä—Å—Ç—è–Ω–∫–∞", "–ü–æ–¥—É—Å–æ–≤–∫–∞", "–í–æ–∫–∑–∞–ª"
    ],
    "–õ—É—Ü–∫": [
        "–¶–µ–Ω—Ç—Ä", "33-–π –∫–≤–∞—Ä—Ç–∞–ª", "40-–π –∫–≤–∞—Ä—Ç–∞–ª", "–í—ã—à–∫–æ–≤", "–ì–Ω–∏–¥–∞–≤–∞", "–í–æ–∫–∑–∞–ª"
    ],
    "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—è": [
        "–¶–µ–Ω—Ç—Ä", "–ü–æ–±–µ–¥–∞", "–ë–ê–ú", "–¢—ã–Ω–Ω—ã–π", "8-—è —à–∫–æ–ª–∞"
    ],
    "–í–∞—Å–∏–ª—å–∫–æ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–ú–∞—Å—Å–∏–≤", "–ì–æ—Ä–æ–¥–æ–∫", "–ü–∏—Å–∫–∏"
    ],
    "–•–æ—Ä–æ–ª": [
        "–¶–µ–Ω—Ç—Ä", "–ú–æ–ª–æ–∫–æ–∑–∞–≤–æ–¥", "–í–æ–∫–∑–∞–ª", "–†—ã–Ω–æ–∫"
    ],
    "–•–µ—Ä—Å–æ–Ω": [
        "–¶–µ–Ω—Ç—Ä", "–¢–∞–≤—Ä–∏—á–µ—Å–∫–∏–π", "–®—É–º–µ–Ω—Å–∫–∏–π", "–•–ë–ö", "–û—Å—Ç—Ä–æ–≤", "–ñ–∏–ª–ø–æ—Å–µ–ª–æ–∫"
    ],
    "–û–±—É—Ö–æ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–®–∫–æ–ª–∞", "–ü–µ—Å—á–∞–Ω–∞—è", "–°–æ—Å–Ω–æ–≤—ã–π", "–ê–≤—Ç–æ—Å—Ç–∞–Ω—Ü–∏—è"
    ],
    "–ó–∞–ø–æ—Ä–æ–∂—å–µ": [
        "–î–Ω–µ–ø—Ä–æ–≤—Å–∫–∏–π", "–í–æ–∑–Ω–µ—Å–µ–Ω–æ–≤—Å–∫–∏–π", "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤—Å–∫–∏–π",
        "–•–æ—Ä—Ç–∏—Ü–∫–∏–π", "–ö–æ–º–º—É–Ω–∞—Ä—Å–∫–∏–π", "–®–µ–≤—á–µ–Ω–∫–æ–≤—Å–∫–∏–π", "–ë–∞–±—É—Ä–∫–∞", "–ü–µ—Å–∫–∏"
    ],
    "–ë–∞–ª–∞–∫–ª–µ—è": [
        "–¶–µ–Ω—Ç—Ä", "–õ–∞–≥–µ—Ä—è", "–ü–æ—Å–µ–ª–æ–∫", "–í–æ–∫–∑–∞–ª"
    ],
    "–ë–∞—à—Ç–∞–Ω–∫–∞": [
        "–¶–µ–Ω—Ç—Ä", "–°—ã—Ä–∑–∞–≤–æ–¥", "–ü–æ–±–µ–¥–∞", "–ê–≥—Ä–æ–ø—Ä–æ–º"
    ],
    "–ù–æ–≤—ã–π –ë—É–≥": [
        "–¶–µ–Ω—Ç—Ä", "–°—Ç–∞–Ω—Ü–∏—è", "–£—á–∏–ª–∏—â–µ", "–¢–µ—Ö–Ω–∏–∫—É–º"
    ],
    "–ö–æ—Ä–æ—Å—Ç—ã—à–µ–≤": [
        "–¶–µ–Ω—Ç—Ä", "–ó–∞—Ä–µ—á—å–µ", "–ö–∞–Ω—å–æ–Ω", "–ú–∞—Å—Å–∏–≤"
    ],
    "–ó–≤—è–≥–µ–ª—å": [
        "–¶–µ–Ω—Ç—Ä", "–î—Ä—É–∂–±–∞", "–ë–æ–ª–≥–∞—Ä—Å—Ç—Ä–æ–π", "–ú–æ—Ä—Å–∫–æ–µ", "–ó–µ–ª–µ–Ω—ã–µ"
    ],
    "–ö–æ–±–ª–µ–≤–æ": [
        "–¶–µ–Ω—Ç—Ä", "–ë–∞–∑—ã –æ—Ç–¥—ã—Ö–∞", "–ú–æ–ª–¥–∞–≤—Å–∫–∏–µ –±–∞–∑—ã", "–ê–∫–≤–∞–ø–∞—Ä–∫"
    ]
}

# –†–∞–π–æ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ –≤—ã—à–µ)
default_districts = ["–¶–µ–Ω—Ç—Ä", "–í–æ–∫–∑–∞–ª", "–ü–∞—Ä–∫", "–†—ã–Ω–æ–∫", "–õ–µ—Å", "–ü—Ä–æ–º–∑–æ–Ω–∞"]

# --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
def get_price_from_string(text):
    match = re.search(r'(\d+)\s*–≥—Ä–Ω', text)
    if match:
        return int(match.group(1))
    return 1000

# --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ---

# –®–∞–≥ 1: –°—Ç–∞—Ä—Ç
@dp.message(Command("start"))
async def cmd_start(message: types.Message, state: FSMContext):
    await state.clear()
    await show_cities_menu(message)

# --- –§–£–ù–ö–¶–ò–Ø –†–ê–°–°–´–õ–ö–ò (–°–ü–ê–ú–ê) ---
@dp.message(Command("send"))
async def cmd_send_all(message: Message):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–º–∞–Ω–¥—É –ø–∏—à–µ—Ç –∞–¥–º–∏–Ω
    if message.from_user.id != ADMIN_ID:
        return

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /send
    text_to_send = message.text[6:] # –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–µ 5 —Å–∏–º–≤–æ–ª–æ–≤ ("/send ")
    
    if not text_to_send:
        await message.answer("–í–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏. –ü—Ä–∏–º–µ—Ä:\n/send –í—Å–µ–º –ø—Ä–∏–≤–µ—Ç, —Å–∫–∏–¥–∫–∏!")
        return

    users = get_all_users()
    count = 0
    blocked = 0

    await message.answer(f"–ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—Å—ã–ª–∫—É –Ω–∞ {len(users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...")

    for user in users:
        user_id = user[0]
        try:
            await bot.send_message(user_id, text_to_send)
            count += 1
            await asyncio.sleep(0.05) # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞, —á—Ç–æ–±—ã —Ç–µ–ª–µ–≥—Ä–∞–º –Ω–µ –∑–∞–±–∞–Ω–∏–ª –∑–∞ —Ñ–ª—É–¥
        except Exception:
            blocked += 1 # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞

    await message.answer(f"‚úÖ –†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {count}\n–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞: {blocked}")
    
# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –≥–æ—Ä–æ–¥–æ–≤
async def show_cities_menu(message_or_call):
    builder = InlineKeyboardBuilder()
    for i, city in enumerate(cities):
        builder.add(InlineKeyboardButton(text=city, callback_data=f"city:{i}"))
    builder.adjust(2) 
    
    welcome_text = (
        "ü•≥ü•≥ü•≥ www.larek.bz ü•≥ü•≥ü•≥\n\n"
        "‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–∞—à–µ–º—É\n"
        "–≤–Ω–∏–º–∞–Ω–∏—é:\n"
        "—Ç–æ–≤–∞—Ä –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ä—Ç–∞, –æ—Ç –ª—É—á—à–∏—Ö —Ö–∏–º–∏–∫–æ–≤ –∏ –≥—Ä–æ–≤–µ—Ä–æ–≤ –£–∫—Ä–∞–∏–Ω—ã‚ÄºÔ∏è‚ÄºÔ∏è‚ÄºÔ∏è\n"
        "‚ÄºÔ∏è –ì–æ—Ç–æ–≤—ã–µ –∫–ª–∞–¥—ã, –æ—Ç 0.5 –¥–æ 100 –≥—Ä–∞–º–º–æ–≤‚ÄºÔ∏è\n"
        "\n\n"
        "–†–∞–±–æ—Ç–∞–µ–º —Ç–∞–∫–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö üá∫üá¶\n"
        "üá∫üá¶ –•–ê–†–¨–ö–û–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –û–î–ï–°–°–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–ò–ï–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –î–ù–ï–ü–† - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ù–ò–ö–û–õ–ê–ï–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–†–ò–í–û–ô –†–û–ì - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –õ–¨–í–û–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–û–°–¢–û–ü–û–õ–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ß–ï–†–ö–ê–°–°–´  - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –°–ú–ï–õ–ê  - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ù–û–í–û–ú–û–°–ö–û–í–°–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ù–û–í–ê–Ø –û–î–ï–°–°–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –°–õ–û–ë–û–ñ–ê–ù–°–ö–û–ï - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ó–ù–ê–ú–ï–ù–û–í–ö–ê- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–û–†–ò–°–ü–û–õ–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –í–´–®–ì–û–†–û–î - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ß–ï–†–ù–û–í–¶–´ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –í–ê–°–ò–©–ï–í–û - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –õ–Æ–ë–û–¢–ò–ù- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ù–ï–¢–ò–®–ò–ù - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–ï–ó–õ–Æ–î–û–í–ö–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–†–û–í–ê–†–´ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –õ–û–ó–û–í–ê–Ø - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ü–û–õ–¢–ê–í–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ñ–ò–¢–û–ú–ò–† - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ú–ï–†–ï–§–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–£–î–´ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ó–ú–ò–ï–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–û–Ø–†–ö–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ù–ï–ñ–ò–ù - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ò–†–ü–ï–ù–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –û–°–¢–†–û–ì - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –†–û–í–ù–û - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –£–ú–ê–ù–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –°–£–ú–´ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –í–ò–ù–ù–ò–¶–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–†–ê–¶–õ–ê–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–ê–ó–ê–¢–ò–ù - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ù–ï–ú–ò–†–û–í- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ñ–ú–ï–†–ò–ù–ö–ê- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ü–ê–í–õ–û–ì–†–ê–î - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ü–û–î–ì–û–†–û–î–ù–û–ï - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–ï–õ–ê–Ø –¶–ï–†–ö–û–í–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –°–¢–†–´–ô - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –î–†–û–ì–û–ë–´–ß - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–ï–†–î–ò–ß–ï–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –¢–†–£–°–ö–ê–í–ï–¶ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –í–û–ó–ù–ï–°–ï–ù–°–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–û–ù–û–¢–û–ü - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –®–û–°–¢–ö–ê- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ó–ê–í–ê–õ–¨–ï- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ñ–ê–ö–ß–ò–ö- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–ï–†–ï–ó–û–í–ö–ê- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –°–ê–í–†–ê–ù–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ß–ï–†–ù–û–ú–û–†–°–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–†–û–ü–ò–í–ù–ò–¶–ö–ò–ô- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ò–í–ê–ù–û-–§–†–ê–ù–ö–û–í–°–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ü–ï–†–í–û–ú–ê–ô–°–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –°–õ–ê–í–Ø–ù–°–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ê–•–¢–´–†–ö–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –†–û–ú–ù–´ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ß–£–ì–£–ï–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –§–ê–°–¢–û–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –¢–ï–†–ù–û–ü–û–õ–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–ê–õ–£–® - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–†–ê–ú–ê–¢–û–†–°–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–û–ù–°–¢–ê–ù–¢–ò–ù–û–í–ö–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–ê–ú–Ø–ù–ï–¶-–ü–û–î–û–õ–¨–°–ö–ò–ô - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ß–ï–†–ù–ò–ì–û–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –õ–£–¶–ö - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ê–õ–ï–ö–°–ê–ù–î–†–ò–Ø - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –í–ê–°–ò–õ–¨–ö–û–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –•–û–†–û–õ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –•–ï–†–°–û–ù - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –û–ë–£–•–û–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ó–ê–ü–û–†–û–ñ–¨–ï - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–ê–õ–ê–ö–õ–ï–Ø - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ë–ê–®–¢–ê–ù–ö–ê - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ù–û–í–´–ô –ë–£–ì- –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–û–†–û–°–¢–´–®–ï–í - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ó–í–Ø–ì–ï–õ–¨ - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "üá∫üá¶ –ö–û–ë–õ–ï–í–û - –≤—Å–µ —Ä–∞–π–æ–Ω—ã\n"
        "–ò –î–†–£–ì–ò–ï –ì–û–†–û–î–ê üá∫üá¶ \n"
        "üî• –£ –Ω–∞—Å –≤—Å–µ–≥–¥–∞ –°–ö–ò–î–ö–ò, –ê–ö–¶–ò–ò,\n"
        "–ü–û–î–ì–û–ù–´, –†–£–õ–ï–¢–ö–ò üî•\n\n"
        "ü•≥ü•≥ü•≥ www.larek.bz ü•≥ü•≥ü•≥\n\n"
        "–ö–æ–Ω—Ç–∞–∫—Ç—ã:\n\n"
        "–û–ø–µ—Ä–∞—Ç–æ—Ä - üòé @LAREK_OPER7 üòé\n\n"
        "–¢—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ - https://t.me/LAREK_W\n\n"
        "–°–∞–π—Ç - https://larek.to\n\n"
        "–∏–ª–∏ - https://larek.nl\n\n"
        "–ß–∞—Ç —Ç–µ–ª–µ–≥—Ä–∞–º–º –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ú–µ–≥–∞ –∫—Ä—É—Ç—ã–µ —Ä—É–ª–µ—Ç–∫–∏:\n\n"
        "https://t.me/+esm8oVYsNiQ4Yzg0\n\n"
        "–û–¢–ó–´–í–´ - —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç–∑—ã–≤—ã –≤ —á–∞—Ç–µ\n\n"
        "ü•≥ü•≥ü•≥ www.larek.bz ü•≥ü•≥ü•≥"
    )

    if isinstance(message_or_call, types.CallbackQuery):
        if message_or_call.message.photo:
            await message_or_call.message.delete()
            await message_or_call.message.answer(text=welcome_text, reply_markup=builder.as_markup(), disable_web_page_preview=True)
        else:
            await message_or_call.message.edit_text(text=welcome_text, reply_markup=builder.as_markup(), disable_web_page_preview=True)
    else:
        await message_or_call.answer(text=welcome_text, reply_markup=builder.as_markup(), disable_web_page_preview=True)

# –®–∞–≥ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞
@dp.callback_query(F.data.startswith("city:"))
async def city_selected(call: CallbackQuery, state: FSMContext):
    city_index = int(call.data.split(":")[1])
    city_name = cities[city_index]
    await state.update_data(city=city_name)
    await show_products_menu(call, city_name)
    await state.set_state(OrderState.choosing_product)

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ç–æ–≤–∞—Ä–æ–≤
async def show_products_menu(call: CallbackQuery, city_name):
    builder = InlineKeyboardBuilder()
    for i, product in enumerate(products):
        builder.add(InlineKeyboardButton(text=product, callback_data=f"prod:{i}"))
    builder.adjust(1)
    builder.row(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≥–æ—Ä–æ–¥–∞–º", callback_data="back_to_cities"))

    text = f"–í—ã –≤—ã–±—Ä–∞–ª–∏ –≥–æ—Ä–æ–¥ {city_name}. –ö–∞–∫–æ–π —Ç–æ–≤–∞—Ä –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?"
    
    if call.message.photo:
        await call.message.delete()
        await call.message.answer(text=text, reply_markup=builder.as_markup())
    else:
        await call.message.edit_text(text=text, reply_markup=builder.as_markup())

# –®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–∞
@dp.callback_query(F.data.startswith("prod:"))
async def product_selected(call: CallbackQuery, state: FSMContext):
    prod_index = int(call.data.split(":")[1])
    product_name = products[prod_index]
    price = get_price_from_string(product_name)
    
    await state.update_data(product_name=product_name, price=price)
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ —Ä–∞–π–æ–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
    data = await state.get_data()
    city_name = data.get('city')
    
    await show_districts_menu(call, product_name, price, city_name)
    await state.set_state(OrderState.choosing_district)

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ä–∞–π–æ–Ω–æ–≤ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç city_name)
async def show_districts_menu(call: CallbackQuery, product_name, price, city_name):
    # –í—ã–±–∏—Ä–∞–µ–º —Ä–∞–π–æ–Ω—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
    current_districts = city_districts.get(city_name, default_districts)

    builder = InlineKeyboardBuilder()
    for i, district in enumerate(current_districts):
        builder.add(InlineKeyboardButton(text=district, callback_data=f"dist:{i}"))
    builder.adjust(2)
    # –ö–Ω–æ–ø–∫–∞ –ù–ê–ó–ê–î
    builder.row(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º", callback_data="back_to_products"))

    caption_text = (
        f"–ì–æ—Ä–æ–¥: {city_name}\n"
        f"–ò–∑–±—Ä–∞–Ω –ø—Ä–æ–¥—É–∫—Ç: {product_name}\n"
        "–ö–æ—Ä–æ—Ç–∫–æ –æ —Ç–æ–≤–∞—Ä–µ: –ü–æ—Ä–æ—à–æ–∫ HQ\n"
        "–í—ã—Å—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ HQ\n"
        f"–¶–µ–Ω–∞: {price} –≥—Ä–Ω.\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ä–∞–π–æ–Ω:"
    )

    if os.path.exists("image.jpg"):
        if call.message.photo:
             await call.message.edit_caption(caption=caption_text, reply_markup=builder.as_markup())
        else:
            await call.message.delete()
            photo = FSInputFile("image.jpg")
            await call.message.answer_photo(photo=photo, caption=caption_text, reply_markup=builder.as_markup())
    else:
        if call.message.photo:
            await call.message.delete()
            await call.message.answer(text=caption_text, reply_markup=builder.as_markup())
        else:
            await call.message.edit_text(text=caption_text, reply_markup=builder.as_markup())

# –®–∞–≥ 4: –í—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞
@dp.callback_query(F.data.startswith("dist:"))
async def district_selected(call: CallbackQuery, state: FSMContext):
    dist_index = int(call.data.split(":")[1])
    
    # –ü–æ–ª—É—á–∞–µ–º –≥–æ—Ä–æ–¥, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∏–∑ –∫–∞–∫–æ–≥–æ —Å–ø–∏—Å–∫–∞ –±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω
    data = await state.get_data()
    city_name = data.get('city')
    current_districts = city_districts.get(city_name, default_districts)
    
    if dist_index < len(current_districts):
        district_name = current_districts[dist_index]
    else:
        district_name = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–∞–π–æ–Ω"
    
    order_id = random.randint(1000000, 9999999)
    await state.update_data(order_id=order_id, district=district_name)
    
    data = await state.get_data()
    await show_payment_menu(call, data)
    await state.set_state(OrderState.choosing_payment)

# –§—É–Ω–∫—Ü–∏—è –º–µ–Ω—é –æ–ø–ª–∞—Ç—ã
async def show_payment_menu(call: CallbackQuery, data):
    price = data['price']
    
    builder = InlineKeyboardBuilder()
    builder.add(InlineKeyboardButton(text=f"GlobalMoney ({price} –≥—Ä–Ω)", callback_data="pay:gm"))
    builder.add(InlineKeyboardButton(text=f"–û–ø–ª–∞—Ç–∞ –Ω–∞ –±–∞–Ω–∫ –∫–∞—Ä—Ç—É. ({price + 150} –≥—Ä–Ω)", callback_data="pay:card"))
    usdt_price = round(price / 40) + 1
    builder.add(InlineKeyboardButton(text=f"USDT TRX ({usdt_price} $)", callback_data="pay:crypto"))
    
    # –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    builder.row(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–∞–π–æ–Ω–∞–º", callback_data="back_to_districts"))
    builder.row(InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", callback_data="cancel"))
    builder.adjust(1)

    order_text = (
        "‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! –ê–¥—Ä–µ—Å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω!\n\n"
        f"–í–∞—à –∑–∞–∫–∞–∑ ‚Ññ: {data['order_id']}\n"
        f"–ì–æ—Ä–æ–¥: {data['city']}\n"
        f"–†–∞–π–æ–Ω: {data['district']}\n"
        f"–¢–æ–≤–∞—Ä: {data['product_name']}\n"
        f"–¶–µ–Ω–∞: {price} –≥—Ä–Ω\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã:"
    )
    
    if call.message.photo:
        await call.message.edit_caption(caption=order_text, reply_markup=builder.as_markup())
    else:
        await call.message.edit_text(text=order_text, reply_markup=builder.as_markup())

# –®–∞–≥ 5: –û–ø–ª–∞—Ç–∞ –ö–∞—Ä—Ç–æ–π
@dp.callback_query(F.data == "pay:card")
async def card_payment_selected(call: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    price = data['price'] + 150
    city = data['city']
    order_id = data['order_id']
    product_name = data['product_name']

    builder = InlineKeyboardBuilder()
    builder.add(InlineKeyboardButton(text="üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É", callback_data="check_status"))
    builder.add(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_payment_methods"))
    builder.add(InlineKeyboardButton(text="‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑", callback_data="cancel"))
    builder.adjust(1)

    payment_text = (
        f"–í–∞—à –∑–∞–∫–∞–∑ ‚Ññ: {order_id}\n"
        f"–ì–æ—Ä–æ–¥: {city}.\n"
        f"–¢–æ–≤–∞—Ä: {product_name}\n"
        f"–¶–µ–Ω–∞: {price} –≥—Ä–Ω\n\n"
        "–ß—Ç–æ–±—ã –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å\n"
        f"—Å–≤–æ–∏–º /pin –∏ –Ω–æ–º–µ—Ä–æ–º –∑–∞–∫–∞–∑–∞ {order_id}.\n\n"
        "–í–ù–ò–ú–ê–ù–ò–ï! –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω—É—é —Å—É–º–º—É!\n"
        "–ù–∞ –æ–ø–ª–∞—Ç—É –∑–∞–∫–∞–∑–∞ –¥–∞—ë—Ç—Å—è 60 –º–∏–Ω—É—Ç.\n\n"
        "–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É 4441 1144 5411 1707\n"
        f"—Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω—É—é —Å—É–º–º—É {price} –≥—Ä–Ω.\n\n"
        "–ù–æ–º–µ—Ä –∑–∞—è–≤–∫–∏ –≤ —Å–∏—Å—Ç–µ–º–µ GetBTK: KP-14D3TWSF4U."
    )

    if call.message.photo:
        await call.message.edit_caption(caption=payment_text, parse_mode="Markdown", reply_markup=builder.as_markup())
    else:
        await call.message.edit_text(text=payment_text, parse_mode="Markdown", reply_markup=builder.as_markup())
    
    await call.answer()

# --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–ù–û–ü–û–ö "–ù–ê–ó–ê–î" ---

@dp.callback_query(F.data == "back_to_cities")
async def back_to_cities(call: CallbackQuery, state: FSMContext):
    await state.clear()
    await show_cities_menu(call)

@dp.callback_query(F.data == "back_to_products")
async def back_to_products(call: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    if 'city' in data:
        await show_products_menu(call, data['city'])
        await state.set_state(OrderState.choosing_product)
    else:
        await show_cities_menu(call)

@dp.callback_query(F.data == "back_to_districts")
async def back_to_districts(call: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    # –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∏ –≥–æ—Ä–æ–¥, –∏ —Ç–æ–≤–∞—Ä, –∏ —Ü–µ–Ω—É
    if 'product_name' in data and 'price' in data and 'city' in data:
        await show_districts_menu(call, data['product_name'], data['price'], data['city'])
        await state.set_state(OrderState.choosing_district)
    else:
        await show_cities_menu(call)

@dp.callback_query(F.data == "back_to_payment_methods")
async def back_to_payment_methods(call: CallbackQuery, state: FSMContext):
    data = await state.get_data()
    await show_payment_menu(call, data)

# –ó–∞–≥–ª—É—à–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
@dp.callback_query(F.data == "check_status")
async def check_status(call: CallbackQuery):
    await call.answer("–û–ø–ª–∞—Ç–∞ –µ—â–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.", show_alert=True)

# –û—Ç–º–µ–Ω–∞
@dp.callback_query(F.data == "cancel")
async def cancel_order(call: CallbackQuery, state: FSMContext):
    await state.clear()
    await call.message.delete()
    await call.message.answer("–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω. –ñ–º–∏ /start –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞.")
    await call.answer()

async def main():
    await bot.delete_webhook(drop_pending_updates=True)
    await dp.start_polling(bot)

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except (KeyboardInterrupt, SystemExit):
        print("Bot stopped!")

