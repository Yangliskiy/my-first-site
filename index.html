<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Lab</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Russo+One&family=Orbitron:wght@500;700;900&display=swap');

        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #000;
            color: #ffffff;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* --- PHYSICS CANVAS BACKGROUND --- */
        #physicsCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%);
        }

        /* --- GLOBAL NEON PULSE FOR FONTS --- */
        /* This makes ALL text glow and breathe */
        body, button, span, div {
            text-shadow: 0 0 5px currentColor;
        }
        
        @keyframes text-breathe {
            0% { text-shadow: 0 0 4px currentColor, 0 0 8px currentColor; filter: brightness(1); }
            50% { text-shadow: 0 0 8px currentColor, 0 0 15px currentColor; filter: brightness(1.3); }
            100% { text-shadow: 0 0 4px currentColor, 0 0 8px currentColor; filter: brightness(1); }
        }

        /* Apply to key text elements */
        h1, h2, .font-title, #scoreDisplay, #energyText, .flask-btn {
            animation: text-breathe 2s infinite ease-in-out;
        }

        /* --- UI ELEMENTS --- */
        .glass-panel {
            background: rgba(10, 10, 15, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .shop-grid { scrollbar-width: none; -ms-overflow-style: none; }
        .shop-grid::-webkit-scrollbar { display: none; }

        .tab-active {
            background: linear-gradient(to top, rgba(168,85,247,0.2), transparent);
            border-bottom: 2px solid #a855f7;
            color: #d8b4fe;
            text-shadow: 0 0 15px #a855f7;
        }
        .tab-inactive {
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
        
        button:active { transform: scale(0.97); }

        /* --- DRAG & DROP & FLASK --- */
        .flask-main {
            transition: transform 0.05s;
            color: #22c55e;
        }
        .flask-main:active { transform: scale(0.95); }

        .draggable-flask {
            touch-action: none;
            position: relative;
            z-index: 20;
            transition: transform 0.1s;
        }
        .draggable-flask.dragging {
            z-index: 100;
            transform: scale(1.3);
            filter: drop-shadow(0 0 20px currentColor);
        }
        .draggable-flask.pouring {
            transition: all 0.5s ease-in-out;
            z-index: 50;
        }
        .pour-stream {
            position: absolute;
            width: 6px;
            height: 0;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: currentColor;
            border-radius: 4px;
            pointer-events: none;
            z-index: 40;
            transition: height 0.2s;
            box-shadow: 0 0 10px currentColor;
        }
        #mixingPot { transition: transform 0.2s; }
        #mixingPot.receive-liquid { transform: scale(1.1); filter: drop-shadow(0 0 20px white); }
        #mixLiquid { transition: fill 0.3s ease, d 0.3s ease; }

        /* --- CASINO --- */
        .roulette-wheel {
            width: 220px; height: 220px;
            border-radius: 50%; border: 6px solid #222;
            background: conic-gradient(#ef4444 0deg 60deg, #f59e0b 60deg 120deg, #22c55e 120deg 180deg, #3b82f6 180deg 240deg, #a855f7 240deg 300deg, #ec4899 300deg 360deg);
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            box-shadow: 0 0 40px rgba(0,0,0,0.8);
        }
        .roulette-pointer {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #fbbf24;
            z-index: 20; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.8));
        }
        
        .spin-ready { background: #eab308; color: black; box-shadow: 0 0 20px #eab308; animation: pulse-gold 1s infinite; }
        @keyframes pulse-gold { 0%, 100% { box-shadow: 0 0 10px #eab308; } 50% { box-shadow: 0 0 30px #eab308; } }
        .spin-cooldown { background: #333; color: #777; cursor: not-allowed; }

        /* --- FLOATING TEXT --- */
        .floating-text {
            position: absolute;
            font-family: 'Russo One', sans-serif;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            z-index: 50;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 10px currentColor;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-80px) scale(1.3); } }

        /* --- SMUGGLER & LEGENDARY --- */
        #smugglerBtn {
            position: absolute; top: 70px; right: 10px; z-index: 60;
            animation: pulse-smuggler 2s infinite;
        }
        @keyframes pulse-smuggler { 0% { transform: scale(1); filter: drop-shadow(0 0 5px #a855f7); } 50% { transform: scale(1.1); filter: drop-shadow(0 0 20px #d8b4fe); } 100% { transform: scale(1); } }
        
        .legendary-item {
            border: 1px solid transparent;
            animation: legendary-border 2s infinite alternate;
            background: linear-gradient(90deg, rgba(0,0,0,0.5), rgba(20,0,30,0.5));
        }
        @keyframes legendary-border {
            0% { border-color: #a855f7; box-shadow: 0 0 5px #a855f7; }
            100% { border-color: #f472b6; box-shadow: 0 0 15px #f472b6, inset 0 0 10px rgba(244, 114, 182, 0.2); }
        }
    </style>
</head>
<body id="gameBody">
    
    <!-- PHYSICS BACKGROUND -->
    <canvas id="physicsCanvas"></canvas>

    <!-- SMUGGLER -->
    <div id="smugglerBtn" class="hidden cursor-pointer" onclick="openSmuggler()">
        <div class="w-16 h-16 rounded-full bg-black border-2 border-purple-500 flex items-center justify-center text-4xl relative shadow-2xl">
            <span class="relative z-10">üïµÔ∏è‚Äç‚ôÇÔ∏è</span>
            <div class="absolute bottom-0 right-0 bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded-tl-lg z-20" id="smugglerTimerDisplay">30s</div>
        </div>
    </div>

    <!-- MAIN UI -->
    <div class="relative z-10 w-full h-full flex flex-col justify-between p-4 max-w-md mx-auto">
        
        <!-- HEADER -->
        <div class="w-full flex justify-between items-center glass-panel rounded-2xl p-4 mb-2 border-l-4 border-purple-500">
            <div class="flex flex-col">
                <span class="text-[10px] text-purple-300 uppercase tracking-widest font-bold">–°–∫–ª–∞–¥ (–º–≥)</span>
                <div class="flex items-center gap-3">
                    <div id="secretAdminBtn" class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center text-sm cursor-pointer select-none">‚ò£</div>
                    <span id="scoreDisplay" class="text-3xl font-bold tracking-wider text-white">0</span>
                </div>
                <div class="text-xs text-purple-400 font-mono mt-1" id="passiveDisplay">0 –º–≥/—Å–µ–∫</div>
            </div>
            <div class="text-right">
                <span class="text-[10px] text-gray-400 uppercase tracking-widest font-bold">–õ–æ–∫–∞—Ü–∏—è</span>
                <div id="levelDisplay" class="text-white font-bold text-lg tracking-wide">–ü–æ–¥–≤–∞–ª</div>
                <div id="multiplierDisplay" class="text-[10px] text-yellow-400 font-bold mt-1">x1</div>
                <div id="boostTimer" class="text-[10px] text-red-400 font-bold mt-1 hidden">–ë–£–°–¢: 30s</div>
            </div>
        </div>

        <!-- CLICK AREA -->
        <div id="clickerArea" class="flex-grow flex items-center justify-center relative min-h-0">
            <div id="clickTarget" class="flask-main w-64 h-64 flex items-center justify-center cursor-pointer select-none relative z-10">
                <svg viewBox="0 0 200 200" class="w-full h-full drop-shadow-[0_0_30px_currentColor]">
                    <defs>
                        <linearGradient id="liquidGrad" x1="0%" y1="100%" x2="0%" y2="0%">
                            <stop offset="0%" stop-color="currentColor" stop-opacity="1" />
                            <stop offset="100%" stop-color="#fff" stop-opacity="0.2" />
                        </linearGradient>
                    </defs>
                    <path d="M75,20 L125,20 L125,70 L160,130 C170,145 170,180 145,180 L55,180 C30,180 30,145 40,130 L75,70 Z" 
                          fill="rgba(255,255,255,0.05)" stroke="currentColor" stroke-width="4" stroke-linejoin="round"/>
                    <path d="M80,80 L120,80 L148,130 C155,142 155,170 140,170 L60,170 C45,170 45,142 52,130 Z" 
                          fill="currentColor" class="opacity-80"/>
                    <circle cx="100" cy="150" r="5" fill="#fff" opacity="0.5"><animate attributeName="cy" values="150;110" dur="1.5s" repeatCount="indefinite"/></circle>
                </svg>
            </div>
        </div>

        <!-- ENERGY -->
        <div class="w-full mb-3">
            <div class="flex justify-between text-xs mb-1 font-bold text-purple-200 tracking-wider">
                <span>‚ö° –≠–ù–ï–†–ì–ò–Ø</span>
                <span id="energyText">1000/1000</span>
            </div>
            <div class="w-full h-3 bg-gray-900 rounded-full border border-white/20 overflow-hidden relative">
                <div id="energyBar" class="h-full bg-gradient-to-r from-purple-900 via-purple-500 to-white transition-all duration-300" style="width: 100%"></div>
            </div>
        </div>

        <!-- TABS & SHOP -->
        <div class="glass-panel rounded-2xl flex flex-col h-[40vh] overflow-hidden relative z-30">
            <div class="flex border-b border-white/10 bg-black/30 overflow-x-auto shrink-0">
                <button onclick="switchTab('upgrades')" id="tabUpgrades" class="flex-1 py-3 px-2 text-xs font-bold uppercase tracking-widest tab-active">–¶–µ—Ö</button>
                <button onclick="switchTab('synthesis')" id="tabSynthesis" class="flex-1 py-3 px-2 text-xs font-bold uppercase tracking-widest tab-inactive">–°–∏–Ω—Ç–µ–∑</button>
                <button onclick="switchTab('casino')" id="tabCasino" class="flex-1 py-3 px-2 text-xs font-bold uppercase tracking-widest tab-inactive text-yellow-400">–£–¥–∞—á–∞</button>
                <button onclick="switchTab('blackmarket')" id="tabBlackmarket" class="flex-1 py-3 px-2 text-xs font-bold uppercase tracking-widest tab-inactive text-red-400">–ß.–†—ã–Ω–æ–∫</button>
            </div>

            <div class="flex-1 overflow-y-auto shop-grid p-3 relative h-full">
                
                <!-- UPGRADES -->
                <div id="contentUpgrades" class="space-y-3">
                    <button onclick="buyUpgrade('location')" id="btnLocation" class="w-full group relative overflow-hidden bg-gradient-to-r from-indigo-900/60 to-purple-900/60 border border-indigo-500/40 rounded-xl p-3 text-left transition-all">
                        <div class="flex justify-between items-center relative z-10">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">üèóÔ∏è</div>
                                <div><div class="text-xs text-indigo-200 uppercase font-bold">–ü–µ—Ä–µ–µ–∑–¥</div><div class="text-[10px] text-indigo-300">–î–æ—Ö–æ–¥ x2</div></div>
                            </div>
                            <div class="text-right"><div class="text-white text-sm font-bold" id="nextLocName">–ì–∞—Ä–∞–∂</div><div class="text-indigo-300 text-xs font-bold" id="costLocation">5,000</div></div>
                        </div>
                    </button>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="buyUpgrade('multitap')" class="bg-white/5 border border-white/10 rounded-xl p-2 text-left h-20 flex flex-col justify-between hover:bg-white/10">
                            <div class="text-[10px] text-purple-300 font-bold uppercase">–°–∏–Ω—Ç–µ–∑</div>
                            <div class="text-white font-bold">–£—Ä. <span id="lvlMultitap">1</span></div>
                            <div class="text-gray-400 text-[10px]" id="costMultitap">100</div>
                        </button>
                        <button onclick="buyUpgrade('energy')" class="bg-white/5 border border-white/10 rounded-xl p-2 text-left h-20 flex flex-col justify-between hover:bg-white/10">
                            <div class="text-[10px] text-pink-300 font-bold uppercase">–ï–º–∫–æ—Å—Ç—å</div>
                            <div class="text-white font-bold">–£—Ä. <span id="lvlEnergy">1</span></div>
                            <div class="text-gray-400 text-[10px]" id="costEnergy">100</div>
                        </button>
                        <button onclick="buyUpgrade('recharge')" class="bg-white/5 border border-white/10 rounded-xl p-2 text-left h-20 flex flex-col justify-between hover:bg-white/10">
                            <div class="text-[10px] text-blue-300 font-bold uppercase">–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ</div>
                            <div class="text-white font-bold">–£—Ä. <span id="lvlRecharge">1</span></div>
                            <div class="text-gray-400 text-[10px]" id="costRecharge">100</div>
                        </button>
                        <button onclick="buyUpgrade('autobot')" class="bg-white/5 border border-white/10 rounded-xl p-2 text-left h-20 flex flex-col justify-between hover:bg-white/10">
                            <div class="text-[10px] text-yellow-300 font-bold uppercase">–ê–≤—Ç–æ-–í–∞—Ä–∫–∞</div>
                            <div class="text-white font-bold">–£—Ä. <span id="lvlAutobot">0</span></div>
                            <div class="text-gray-400 text-[10px]" id="costAutobot">500</div>
                        </button>
                    </div>
                </div>

                <!-- SYNTHESIS -->
                <div id="contentSynthesis" class="hidden h-full flex flex-col items-center">
                    <div class="w-full bg-black/40 rounded-xl p-2 text-center border border-white/10 mb-4">
                        <div class="flex items-center justify-center gap-2">
                            <div id="targetColorSample" class="w-6 h-6 rounded-full border border-white/50 shadow-[0_0_15px_currentColor]"></div>
                            <span id="targetColorName" class="font-bold text-lg">–¶–ï–õ–¨</span>
                        </div>
                    </div>
                    <div class="flex-grow w-full flex flex-col items-center justify-center">
                        <div id="mixingPot" class="relative w-32 h-32 flex items-center justify-center transition-transform">
                            <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-[0_0_20px_rgba(255,255,255,0.2)] pointer-events-none">
                                <path d="M20,20 L80,20 L80,80 C80,90 70,95 50,95 C30,95 20,90 20,80 Z" fill="rgba(255,255,255,0.05)" stroke="white" stroke-width="1"/>
                                <path id="mixLiquid" d="M22,88 L78,88 L78,90 C78,92 68,93 50,93 C32,93 22,92 22,90 Z" fill="#111" class="mix-liquid"/>
                            </svg>
                        </div>
                        <div class="w-full grid grid-cols-3 gap-2 px-2 h-24 items-end mt-4">
                            <!-- Flasks -->
                            <div class="flex flex-col items-center"><div class="draggable-flask w-12 h-16 cursor-grab text-red-500" data-color="red"><div class="pour-stream"></div><svg viewBox="0 0 50 80" class="w-full h-full drop-shadow-[0_0_10px_currentColor] pointer-events-none"><path d="M15,2 L35,2 L35,20 L45,70 C48,78 40,78 25,78 C10,78 2,78 5,70 L15,20 Z" fill="rgba(255,0,0,0.1)" stroke="currentColor"/><path d="M16,20 L34,20 L44,70 C46,76 40,76 25,76 C10,76 4,76 6,70 Z" fill="currentColor"/></svg></div></div>
                            <div class="flex flex-col items-center"><div class="draggable-flask w-12 h-16 cursor-grab text-green-500" data-color="green"><div class="pour-stream"></div><svg viewBox="0 0 50 80" class="w-full h-full drop-shadow-[0_0_10px_currentColor] pointer-events-none"><path d="M15,2 L35,2 L35,20 L45,70 C48,78 40,78 25,78 C10,78 2,78 5,70 L15,20 Z" fill="rgba(0,255,0,0.1)" stroke="currentColor"/><path d="M16,20 L34,20 L44,70 C46,76 40,76 25,76 C10,76 4,76 6,70 Z" fill="currentColor"/></svg></div></div>
                            <div class="flex flex-col items-center"><div class="draggable-flask w-12 h-16 cursor-grab text-blue-500" data-color="blue"><div class="pour-stream"></div><svg viewBox="0 0 50 80" class="w-full h-full drop-shadow-[0_0_10px_currentColor] pointer-events-none"><path d="M15,2 L35,2 L35,20 L45,70 C48,78 40,78 25,78 C10,78 2,78 5,70 L15,20 Z" fill="rgba(0,0,255,0.1)" stroke="currentColor"/><path d="M16,20 L34,20 L44,70 C46,76 40,76 25,76 C10,76 4,76 6,70 Z" fill="currentColor"/></svg></div></div>
                        </div>
                    </div>
                    <button onclick="resetMix()" class="text-xs text-gray-400 underline mb-2 absolute top-2 right-4">–°–ë–†–û–°</button>
                    <div id="synthesisCooldown" class="absolute inset-0 bg-black/90 z-50 flex flex-col items-center justify-center text-center hidden backdrop-blur-md rounded-lg">
                        <div class="text-white font-bold text-lg">–û–•–õ–ê–ñ–î–ï–ù–ò–ï</div>
                        <div id="cooldownTimer" class="text-3xl font-mono text-purple-400 font-bold mt-2">00:00</div>
                    </div>
                </div>

                <!-- CASINO -->
                <div id="contentCasino" class="hidden h-full flex flex-col items-center space-y-4 pt-2">
                    <div class="w-full bg-white/5 rounded-2xl p-4 border border-white/10 flex flex-col items-center shadow-lg">
                        <div class="relative mb-4">
                            <div class="roulette-pointer"></div>
                            <div class="roulette-wheel" id="rouletteWheel"></div>
                            <div class="roulette-center"></div>
                        </div>
                        <button id="btnSpin" onclick="spinRoulette()" class="spin-ready text-black font-bold py-3 px-10 rounded-full uppercase tracking-widest shadow-lg transition w-full">–ö–†–£–¢–ò–¢–¨</button>
                        <div id="spinTimer" class="text-xs text-gray-400 mt-2 hidden">–¢–∞–π–º–µ—Ä: <span id="spinTimeVal">00:00:00</span></div>
                    </div>
                    <div class="w-full grid grid-cols-2 gap-3">
                        <button onclick="openCase('basic')" class="bg-gray-800/80 border border-gray-600/50 p-3 rounded-xl flex flex-col items-center active:scale-95 transition">
                            <div class="text-4xl mb-2">üì¶</div>
                            <div class="text-xs text-gray-300 font-bold">–ë–ê–ó–û–í–´–ô</div>
                            <div class="text-green-400 text-xs font-mono font-bold">2,000</div>
                        </button>
                        <button onclick="openCase('neon')" class="bg-purple-900/30 border border-purple-500/50 p-3 rounded-xl flex flex-col items-center active:scale-95 transition">
                            <div class="text-4xl mb-2">üîí</div>
                            <div class="text-xs text-purple-300 font-bold">–ö–ò–ë–ï–†</div>
                            <div class="text-purple-400 text-xs font-mono font-bold">20,000</div>
                        </button>
                    </div>
                </div>

                <!-- BLACK MARKET -->
                <div id="contentBlackmarket" class="hidden space-y-3 pt-2">
                    <button onclick="buyItem('unstableIsotope')" id="btnIsotope" class="w-full bg-red-900/20 border border-red-500/30 rounded-xl p-3 text-left flex justify-between items-center transition hover:bg-red-900/30">
                        <div class="flex items-center gap-3"><div class="text-2xl">‚ò¢Ô∏è</div><div><div class="text-sm text-red-300 font-bold">–ò–∑–æ—Ç–æ–ø</div><div class="text-[10px] text-gray-400">–ö—Ä–∏—Ç x5</div></div></div>
                        <div class="text-right"><div class="text-red-400 font-mono font-bold text-sm" id="costIsotope">2,500</div><div id="statusIsotope" class="hidden text-xs text-green-500 border border-green-500 px-1 rounded">V</div></div>
                    </button>
                    <button onclick="buyItem('blueCrystal')" id="btnCrystal" class="w-full bg-cyan-900/20 border border-cyan-500/30 rounded-xl p-3 text-left flex justify-between items-center transition hover:bg-cyan-900/30">
                        <div class="flex items-center gap-3"><div class="text-2xl">üíé</div><div><div class="text-sm text-cyan-300 font-bold">–ö—Ä–∏—Å—Ç–∞–ª–ª</div><div class="text-[10px] text-gray-400">–î–æ—Ö–æ–¥ x2</div></div></div>
                        <div class="text-right"><div class="text-cyan-400 font-mono font-bold text-sm" id="costCrystal">10,000</div><div id="statusCrystal" class="hidden text-xs text-green-500 border border-green-500 px-1 rounded">V</div></div>
                    </button>
                    <button onclick="buyItem('darkMatter')" id="btnDarkMatter" class="w-full bg-fuchsia-900/20 border border-fuchsia-500/30 rounded-xl p-3 text-left flex justify-between items-center transition hover:bg-fuchsia-900/30">
                        <div class="flex items-center gap-3"><div class="text-2xl">üåå</div><div><div class="text-sm text-fuchsia-300 font-bold">–ú–∞—Ç–µ—Ä–∏—è</div><div class="text-[10px] text-gray-400">–î–æ—Ö–æ–¥ x5</div></div></div>
                        <div class="text-right"><div class="text-fuchsia-400 font-mono font-bold text-sm" id="costDarkMatter">100k</div><div id="statusDarkMatter" class="hidden text-xs text-green-500 border border-green-500 px-1 rounded">V</div></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SMUGGLER MODAL -->
    <div id="smugglerModal" class="fixed inset-0 z-[100] hidden flex flex-col justify-center items-center p-6 bg-black/90 backdrop-blur-xl">
        <div class="smuggler-modal w-full max-w-sm rounded-3xl p-6 relative overflow-hidden flex flex-col border border-purple-500/50 shadow-[0_0_50px_purple]">
            <button class="absolute top-3 right-3 text-white/50 text-2xl" onclick="closeSmuggler()">‚úï</button>
            <div class="text-center mb-4">
                <div class="text-6xl mb-2 animate-bounce">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
                <h2 class="text-xl font-bold text-white uppercase tracking-widest">–ö–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∏—Å—Ç</h2>
                <div class="text-xs text-gray-400">–£—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑: <span id="smugglerModalTimer" class="text-red-500 font-mono font-bold">30s</span></div>
            </div>
            <div class="space-y-3">
                <button onclick="buyLegendary('hulkSerum')" class="w-full rounded-xl p-3 flex items-center gap-3 legendary-item active:scale-95 transition"><div class="text-3xl">üß™</div><div class="text-left flex-1"><div class="text-green-300 font-bold text-xs">–°—ã–≤–æ—Ä–æ—Ç–∫–∞ –•–∞–ª–∫–∞</div><div class="text-[10px] text-gray-400">–ö–ª–∏–∫ x50 (60s)</div></div><div class="text-yellow-400 font-bold text-sm">50k</div></button>
                <button onclick="buyLegendary('timeLoop')" class="w-full rounded-xl p-3 flex items-center gap-3 legendary-item active:scale-95 transition"><div class="text-3xl">‚è≥</div><div class="text-left flex-1"><div class="text-blue-300 font-bold text-xs">–ü–µ—Ç–ª—è –í—Ä–µ–º–µ–Ω–∏</div><div class="text-[10px] text-gray-400">+4 —á–∞—Å–∞</div></div><div class="text-yellow-400 font-bold text-sm">100k</div></button>
                <button onclick="buyLegendary('unicornTear')" class="w-full rounded-xl p-3 flex items-center gap-3 legendary-item active:scale-95 transition"><div class="text-3xl">üíé</div><div class="text-left flex-1"><div class="text-pink-300 font-bold text-xs">–°–ª–µ–∑–∞ –ï–¥–∏–Ω–æ—Ä–æ–≥–∞</div><div class="text-[10px] text-gray-400">–í–µ—á–Ω—ã–π x5</div></div><div class="text-yellow-400 font-bold text-sm">1M</div></button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 bg-black/80 border border-purple-500 text-white px-6 py-3 rounded-xl opacity-0 pointer-events-none text-sm font-bold font-mono uppercase transition-all z-[200]">Msg</div>

    <script>
        /* --- PHYSICS BACKGROUND --- */
        const canvas = document.getElementById('physicsCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let tiltX = 0, tiltY = 0;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 2 + 1;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.color = `hsl(${Math.random()*60 + 240}, 70%, 70%)`; // Blue/Purple range
                this.alpha = Math.random() * 0.5 + 0.2;
            }
            update() {
                // Gravity based on tilt
                this.vx += tiltX * 0.05;
                this.vy += tiltY * 0.05;
                
                // Friction
                this.vx *= 0.98;
                this.vy *= 0.98;

                this.x += this.vx;
                this.y += this.vy;

                // Wrap around
                if(this.x < 0) this.x = width;
                if(this.x > width) this.x = 0;
                if(this.y < 0) this.y = height;
                if(this.y > height) this.y = 0;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.alpha;
                ctx.fill();
                ctx.globalAlpha = 1;
                // Glow
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
            }
        }

        // Init Particles
        for(let i=0; i<80; i++) particles.push(new Particle());

        function animateBg() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateBg);
        }
        animateBg();

        // Phone Physics
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (e) => {
                tiltX = (e.gamma) / 45; // Left/Right
                tiltY = (e.beta) / 45;  // Front/Back
                // Clamp
                if(tiltX > 1) tiltX=1; if(tiltX < -1) tiltX=-1;
                if(tiltY > 1) tiltY=1; if(tiltY < -1) tiltY=-1;
            });
        }
        // Mouse fallback
        document.addEventListener('mousemove', (e) => {
            tiltX = (e.clientX / width - 0.5) * 2;
            tiltY = (e.clientY / height - 0.5) * 2;
        });


        /* --- GAME LOGIC --- */
        const GameState = {
            balance: 0,
            energy: 1000, maxEnergy: 1000, energyRechargeRate: 3,
            multitapLevel: 1, energyLevel: 1, rechargeLevel: 1, autobotLevel: 0, locationLevel: 0,
            multiplier: 1, permMultiplier: 1,
            items: { unstableIsotope: false, blueCrystal: false, darkMatter: false },
            boostEndTime: 0, hulkEndTime: 0,
            synthesisCooldown: 0, lastSpinTime: 0,
            smuggler: { active: false, departTime: 0, nextArrival: Date.now() + 60000 },
            lastSaveTime: Date.now()
        };

        const LocationNames = ["–ü–æ–¥–≤–∞–ª", "–ì–∞—Ä–∞–∂", "–ó–∞–≤–æ–¥", "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", "–ö–æ—Å–º–æ—Å"];
        const Upgrades = {
            multitap: { baseCost: 100, costMultiplier: 2.0, powerBase: 1 },
            energy: { baseCost: 100, costMultiplier: 1.5, powerBase: 500 },
            recharge: { baseCost: 300, costMultiplier: 1.8, powerBase: 1 },
            autobot: { baseCost: 500, costMultiplier: 2.5, powerBase: 1 },
            location: { baseCost: 5000, costMultiplier: 5.0, powerBase: 1 }
        };
        const SpecialItems = { unstableIsotope: { cost: 2500 }, blueCrystal: { cost: 10000 }, darkMatter: { cost: 100000 } };
        const MixRecipes = { "purple": ["red", "blue"], "yellow": ["red", "green"], "cyan": ["green", "blue"], "white": ["red", "green", "blue"] };
        const ColorNames = { "purple": {name: "–§–ò–û–õ–ï–¢–û–í–´–ô", hex: "#a855f7"}, "yellow": {name: "–ñ–ï–õ–¢–´–ô", hex: "#eab308"}, "cyan": {name: "–ë–ò–†–Æ–ó–û–í–´–ô", hex: "#06b6d4"}, "white": {name: "–ë–ï–õ–´–ô", hex: "#ffffff"} };
        
        let currentMix = [];
        let targetMix = "";
        const tg = window.Telegram.WebApp;

        function initTelegram() { tg.expand(); tg.ready(); tg.setHeaderColor('#000000'); tg.setBackgroundColor('#000000'); }

        function loadGame() {
            const saved = localStorage.getItem('neonLabSave_v18'); // Bump version
            if (saved) { Object.assign(GameState, JSON.parse(saved)); } 
            else { GameState.lastSpinTime = 0; } // Fresh start spin available
            recalcMultiplier(); initSynthesis(); initDraggableFlasks(); updateUI();
        }
        function saveGame() { GameState.lastSaveTime = Date.now(); localStorage.setItem('neonLabSave_v18', JSON.stringify(GameState)); }

        function recalcMultiplier() {
            let mult = 1;
            if(GameState.items.blueCrystal) mult *= 2; if(GameState.items.darkMatter) mult *= 5;
            mult *= GameState.permMultiplier;
            if(GameState.locationLevel > 0) mult *= Math.pow(2, GameState.locationLevel);
            if(Date.now() < GameState.boostEndTime) mult *= 10;
            if(Date.now() < GameState.hulkEndTime) mult *= 50;
            GameState.multiplier = mult;
        }

        // --- CORE UI UPDATES ---
        function updateUI() {
            document.getElementById('scoreDisplay').innerText = Math.floor(GameState.balance).toLocaleString();
            document.getElementById('energyText').innerText = Math.floor(GameState.energy) + "/" + GameState.maxEnergy;
            document.getElementById('energyBar').style.width = (GameState.energy/GameState.maxEnergy*100) + "%";
            
            const isHulk = Date.now() < GameState.hulkEndTime;
            const isBoost = Date.now() < GameState.boostEndTime;
            document.getElementById('multiplierDisplay').innerText = "x" + GameState.multiplier + (isHulk?" üî•":isBoost?" ‚ö°":"");
            document.getElementById('multiplierDisplay').style.opacity = GameState.multiplier > 1 ? 1 : 0;

            const boostTimer = document.getElementById('boostTimer');
            if(isHulk) { boostTimer.classList.remove('hidden'); boostTimer.innerText = "–•–ê–õ–ö: " + Math.ceil((GameState.hulkEndTime - Date.now())/1000) + "s"; }
            else if(isBoost) { boostTimer.classList.remove('hidden'); boostTimer.innerText = "–ë–£–°–¢: " + Math.ceil((GameState.boostEndTime - Date.now())/1000) + "s"; }
            else { boostTimer.classList.add('hidden'); }

            // Casino
            const diff = Date.now() - GameState.lastSpinTime;
            const spinBtn = document.getElementById('btnSpin');
            const spinTimer = document.getElementById('spinTimer');
            if(diff >= 86400000) {
                spinBtn.disabled = false; spinBtn.classList.remove('spin-cooldown'); spinBtn.classList.add('spin-ready'); spinBtn.innerText = "–ö–†–£–¢–ò–¢–¨"; spinTimer.classList.add('hidden');
            } else {
                spinBtn.disabled = true; spinBtn.classList.remove('spin-ready'); spinBtn.classList.add('spin-cooldown'); spinBtn.innerText = "–ñ–î–ê–¢–¨"; spinTimer.classList.remove('hidden');
                const left = 86400000 - diff;
                const h = Math.floor(left/3600000), m = Math.floor((left%3600000)/60000), s = Math.floor((left%60000)/1000);
                document.getElementById('spinTimeVal').innerText = `${h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            }

            // Synthesis Cooldown
            const cool = document.getElementById('synthesisCooldown');
            if(Date.now() < GameState.synthesisCooldown) {
                cool.classList.remove('hidden');
                const min = Math.floor((GameState.synthesisCooldown - Date.now())/60000);
                const sec = Math.floor(((GameState.synthesisCooldown - Date.now())%60000)/1000);
                document.getElementById('cooldownTimer').innerText = `${min}:${sec<10?'0'+sec:sec}`;
            } else { cool.classList.add('hidden'); }

            // Costs
            const getCost = (t, l) => Math.floor(Upgrades[t].baseCost * Math.pow(Upgrades[t].costMultiplier, l-1));
            document.getElementById('costMultitap').innerText = getCost('multitap', GameState.multitapLevel);
            document.getElementById('lvlMultitap').innerText = GameState.multitapLevel;
            document.getElementById('costEnergy').innerText = getCost('energy', GameState.energyLevel);
            document.getElementById('lvlEnergy').innerText = GameState.energyLevel;
            document.getElementById('costRecharge').innerText = getCost('recharge', GameState.rechargeLevel);
            document.getElementById('lvlRecharge').innerText = GameState.rechargeLevel;
            document.getElementById('costAutobot').innerText = getCost('autobot', GameState.autobotLevel+1);
            document.getElementById('lvlAutobot').innerText = GameState.autobotLevel;

            if(GameState.locationLevel >= 4) { document.getElementById('costLocation').innerText = "–ú–ê–ö–°"; document.getElementById('nextLocName').innerText = "–ö–û–°–ú–û–°"; }
            else { document.getElementById('costLocation').innerText = getCost('location', GameState.locationLevel+1); document.getElementById('nextLocName').innerText = LocationNames[GameState.locationLevel+1]; }
            document.getElementById('levelDisplay').innerText = LocationNames[GameState.locationLevel];

            // Items
            ['Isotope','Crystal','DarkMatter'].forEach(id => {
                const key = id === 'Isotope' ? 'unstableIsotope' : id === 'Crystal' ? 'blueCrystal' : 'darkMatter';
                if(GameState.items[key]) {
                    document.getElementById('cost'+id).parentElement.style.display = 'none';
                    document.getElementById('status'+id).classList.remove('hidden');
                    document.getElementById('btn'+id).style.opacity = '0.5';
                }
            });
        }

        // --- SMUGGLER ---
        function checkSmuggler() {
            const now = Date.now();
            if (!GameState.smuggler.active && now > GameState.smuggler.nextArrival) {
                GameState.smuggler.active = true; GameState.smuggler.departTime = now + 30000;
                showToast("–¢–û–†–ì–û–í–ï–¶ –ü–†–ò–ë–´–õ!");
            }
            if (GameState.smuggler.active && now > GameState.smuggler.departTime) {
                GameState.smuggler.active = false; GameState.smuggler.nextArrival = now + 180000;
                closeSmuggler();
            }
            const btn = document.getElementById('smugglerBtn');
            if(GameState.smuggler.active) {
                btn.classList.remove('hidden');
                document.getElementById('smugglerTimerDisplay').innerText = Math.ceil((GameState.smuggler.departTime - now)/1000) + 's';
                document.getElementById('smugglerModalTimer').innerText = Math.ceil((GameState.smuggler.departTime - now)/1000) + 's';
            } else { btn.classList.add('hidden'); }
        }
        function openSmuggler() { document.getElementById('smugglerModal').classList.remove('hidden'); }
        function closeSmuggler() { document.getElementById('smugglerModal').classList.add('hidden'); }
        function buyLegendary(type) {
            let cost = (type==='hulkSerum')?50000:(type==='timeLoop')?100000:1000000;
            if(GameState.balance >= cost) {
                GameState.balance -= cost;
                if(type==='hulkSerum') { GameState.hulkEndTime = Date.now()+60000; showToast("–°–ò–õ–ê –•–ê–õ–ö–ê!"); }
                if(type==='timeLoop') { GameState.balance += Math.max(10000, (GameState.autobotLevel * Upgrades.autobot.powerBase * GameState.multiplier)*14400); showToast("–í–†–ï–ú–Ø –ü–ï–†–ï–ú–û–¢–ê–ù–û!"); }
                if(type==='unicornTear') { GameState.permMultiplier *= 5; showToast("–í–ï–ß–ù–´–ô –ë–£–°–¢!"); }
                recalcMultiplier(); closeSmuggler();
            } else { showToast("–ù–ï –•–í–ê–¢–ê–ï–¢!"); }
        }

        // --- CLICKER ---
        const clickTarget = document.getElementById('clickTarget');
        clickTarget.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            if (GameState.energy >= 1) {
                let power = GameState.multitapLevel * GameState.multiplier;
                let isCrit = false;
                if(GameState.items.unstableIsotope && Math.random()<0.1) { isCrit=true; power*=5; tg.HapticFeedback.notificationOccurred('warning'); }
                else tg.HapticFeedback.impactOccurred('medium');
                
                GameState.balance += power; GameState.energy -= 1;
                createFloatingText(e.clientX, e.clientY, `+${Math.floor(power)}`, isCrit);
                
                // Visuals
                clickTarget.style.transform = `scale(0.95) rotate(${Math.random()*10-5}deg)`;
                setTimeout(()=>clickTarget.style.transform = 'scale(1)', 50);
                
                // Color shift based on state
                const flask = document.getElementById('clickTarget');
                if(Date.now() < GameState.hulkEndTime) flask.style.color = '#a855f7';
                else if(Date.now() < GameState.boostEndTime) flask.style.color = '#ef4444';
                else flask.style.color = '#22c55e';
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
            updateUI();
        });

        function createFloatingText(x, y, txt, crit) {
            const el = document.createElement('div');
            el.className = 'floating-text' + (crit ? ' crit-text' : '');
            el.innerText = txt;
            el.style.left = x + 'px'; el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(()=>el.remove(), 800);
        }

        // --- CASINO ---
        function spinRoulette() {
            if(Date.now() - GameState.lastSpinTime < 86400000) return;
            document.getElementById('btnSpin').disabled = true;
            const wheel = document.getElementById('rouletteWheel');
            const deg = 1800 + Math.random()*360;
            wheel.style.transition = "transform 4s ease-out";
            wheel.style.transform = `rotate(${deg}deg)`;
            setTimeout(() => {
                const seg = Math.floor(((deg % 360)) / 60); // Roughly
                let prize = 0; let msg = "";
                // Simple random prize logic for simplicity
                const r = Math.random();
                if(r<0.5) { prize=1000; msg="1,000 –º–≥"; }
                else if(r<0.8) { prize=5000; msg="5,000 –º–≥"; }
                else if(r<0.95) { prize=10000; msg="10,000 –º–≥"; }
                else { prize=50000; msg="–î–ñ–ï–ö–ü–û–¢ 50K!"; }
                
                GameState.balance += prize;
                GameState.lastSpinTime = Date.now();
                showToast("–í–´–ò–ì–†–´–®: " + msg);
                updateUI();
            }, 4000);
        }
        function openCase(type) {
            let cost = type==='basic'?2000:20000;
            if(GameState.balance < cost) { showToast("–ù–ï–¢ –î–ï–ù–ï–ì!"); return; }
            GameState.balance -= cost;
            const btn = document.getElementById(type==='basic'?'caseBasic':'caseNeon');
            btn.classList.add('shake-box');
            setTimeout(() => {
                btn.classList.remove('shake-box');
                let prize = Math.floor(cost * (0.5 + Math.random()));
                if(Math.random()>0.7) prize *= 2;
                GameState.balance += prize;
                showToast(`–ü–†–ò–ó: ${prize.toLocaleString()} –º–≥`);
                updateUI();
            }, 500);
        }

        // --- SYNTHESIS MINIGAME ---
        function initSynthesis() {
            const keys = Object.keys(MixRecipes);
            targetMix = keys[Math.floor(Math.random() * keys.length)];
            const info = ColorNames[targetMix];
            document.getElementById('targetColorName').innerText = info.name;
            document.getElementById('targetColorName').style.color = info.hex;
            document.getElementById('targetColorSample').style.backgroundColor = info.hex;
            document.getElementById('targetColorSample').style.boxShadow = `0 0 20px ${info.hex}`;
            currentMix = [];
            updateMixVisuals();
        }
        function initDraggableFlasks() {
            const flasks = document.querySelectorAll('.draggable-flask');
            const mixingPot = document.getElementById('mixingPot');
            flasks.forEach(f => {
                f.addEventListener('touchstart', (e)=>{
                    if(Date.now() < GameState.synthesisCooldown) return;
                    e.preventDefault(); f.classList.add('dragging');
                });
                f.addEventListener('touchend', (e)=>{
                    f.classList.remove('dragging');
                    // Simple collision logic for mobile
                    const rect1 = f.getBoundingClientRect();
                    const rect2 = mixingPot.getBoundingClientRect();
                    if(rect1.bottom > rect2.top && rect1.top < rect2.bottom && rect1.right > rect2.left && rect1.left < rect2.right) {
                        const color = f.dataset.color;
                        if(currentMix.length < 3 && !currentMix.includes(color)) {
                            currentMix.push(color); updateMixVisuals();
                            const recipe = MixRecipes[targetMix];
                            const s1 = [...currentMix].sort().join(','), s2 = [...recipe].sort().join(',');
                            if(s1===s2) {
                                GameState.boostEndTime = Date.now()+30000; GameState.synthesisCooldown = Date.now()+300000;
                                recalcMultiplier(); switchTab('upgrades'); showToast("–°–ò–ù–¢–ï–ó –£–°–ü–ï–®–ï–ù!"); initSynthesis();
                            } else if(currentMix.length >= recipe.length) {
                                showToast("–û–®–ò–ë–ö–ê!"); setTimeout(()=>{ currentMix=[]; updateMixVisuals(); }, 500);
                            }
                        }
                    }
                    f.style.transform = '';
                });
                f.addEventListener('touchmove', (e)=>{
                    if(!f.classList.contains('dragging')) return;
                    const touch = e.touches[0];
                    // Visual drag only, logic in touchend
                    f.style.transform = `translate(${touch.clientX - f.getBoundingClientRect().left - 20}px, ${touch.clientY - f.getBoundingClientRect().top - 40}px) scale(1.2)`;
                });
            });
        }
        function updateMixVisuals() {
            const liquid = document.getElementById('mixLiquid');
            if(currentMix.length===0) liquid.style.fill="#111";
            else {
                // Simple color avg
                const map = {red:[255,0,0], green:[0,255,0], blue:[0,0,255]};
                let r=0,g=0,b=0;
                currentMix.forEach(c=>{ r+=map[c][0]; g+=map[c][1]; b+=map[c][2]; });
                r/=currentMix.length; g/=currentMix.length; b/=currentMix.length;
                liquid.style.fill = `rgb(${r},${g},${b})`;
            }
        }
        function resetMix() { currentMix=[]; updateMixVisuals(); }

        // --- ADMIN ---
        let ac=0, at;
        document.getElementById('secretAdminBtn').addEventListener('click', ()=>{
            ac++; clearTimeout(at); at=setTimeout(()=>{ac=0},1000);
            if(ac>=10) { GameState.balance+=1000000000; GameState.lastSpinTime=0; GameState.smuggler.nextArrival=Date.now(); saveGame(); updateUI(); showToast("ADMIN GOD MODE"); ac=0;}
        });

        // --- UTILS ---
        function buyUpgrade(t) {
            if(t==='location' && GameState.locationLevel>=4) return;
            let lvl = (t==='multitap'?GameState.multitapLevel:t==='energy'?GameState.energyLevel:t==='recharge'?GameState.rechargeLevel:t==='autobot'?GameState.autobotLevel+1:GameState.locationLevel+1);
            let cost = Math.floor(Upgrades[t].baseCost * Math.pow(Upgrades[t].costMultiplier, lvl-1));
            if(GameState.balance>=cost) {
                GameState.balance-=cost;
                if(t==='multitap') GameState.multitapLevel++;
                if(t==='energy') { GameState.energyLevel++; GameState.maxEnergy+=500; GameState.energy=GameState.maxEnergy; }
                if(t==='recharge') GameState.rechargeLevel++;
                if(t==='autobot') GameState.autobotLevel++;
                if(t==='location') { GameState.locationLevel++; showToast("–ù–û–í–ê–Ø –õ–û–ö–ê–¶–ò–Ø!"); }
                recalcMultiplier(); saveGame(); updateUI();
            } else showToast("–ù–ï–¢ –î–ï–ù–ï–ì");
        }
        function buyItem(k) {
            if(GameState.items[k]) return;
            if(GameState.balance >= SpecialItems[k].cost) {
                GameState.balance -= SpecialItems[k].cost;
                GameState.items[k] = true; recalcMultiplier(); saveGame(); updateUI();
            }
        }
        function showToast(m) {
            const t=document.getElementById('toast'); t.innerText=m; t.style.opacity=1; t.style.transform='translate(-50%,0) scale(1)';
            setTimeout(()=>{t.style.opacity=0; t.style.transform='translate(-50%,0) scale(0.9)';},2000);
        }
        function switchTab(t) {
            ['upgrades','synthesis','casino','blackmarket'].forEach(id=>{
                const b=document.getElementById('tab'+id.charAt(0).toUpperCase()+id.slice(1));
                const c=document.getElementById('content'+id.charAt(0).toUpperCase()+id.slice(1));
                if(id===t) { b.classList.add('tab-active'); b.classList.remove('tab-inactive'); c.classList.remove('hidden'); }
                else { b.classList.add('tab-inactive'); b.classList.remove('tab-active'); c.classList.add('hidden'); }
            });
        }

        // Loop
        setInterval(()=>{
            if(GameState.energy<GameState.maxEnergy) GameState.energy = Math.min(GameState.maxEnergy, GameState.energy+GameState.energyRechargeRate);
            if(GameState.autobotLevel>0) GameState.balance += GameState.autobotLevel * Upgrades.autobot.powerBase * GameState.multiplier;
            if((GameState.boostEndTime>0 && Date.now()>GameState.boostEndTime) || (GameState.hulkEndTime>0 && Date.now()>GameState.hulkEndTime)) recalcMultiplier();
            checkSmuggler(); updateUI();
            if(Date.now()-GameState.lastSaveTime>5000) saveGame();
        }, 1000);

        initTelegram(); loadGame();
    </script>
</body>
</html>
